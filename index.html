<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viewer Laporan Keuangan IDX</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#071129 0%, #071b2a 100%); color:#e6eef6; margin:0; padding:24px}
    .container{max-width:980px;margin:0 auto}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 22px rgba(2,6,23,0.6);}
    h1{margin:0 0 6px;font-size:20px}
    p.lead{color:var(--muted);margin:0 0 16px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],select,textarea{width:100%;padding:10px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .actions{display:flex;gap:8px;margin-top:12px}
    button{background:linear-gradient(90deg,var(--accent),#7dd3fc);border:none;padding:10px 12px;border-radius:10px;color:#042028;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    pre{white-space:pre-wrap;background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;color:#dff3fb}
    .result-item{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;gap:8px;align-items:center;justify-content:space-between}
    .links{flex:1;overflow-wrap:anywhere;margin-right:8px}
    small{color:var(--muted)}
    .controls{display:flex;gap:8px;margin-top:10px}
    .note{font-size:13px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Viewer Laporan Keuangan IDX ðŸ“„</h1>
      <p class="lead">Masukkan pilihanmu lalu klik <strong>Generate</strong>. Hasil akan muncul di bawah dan bisa disalin atau diunduh sebagai file teks.</p>

      <div style="display:grid;gap:12px">
        <div>
          <label>Jenis Laporan</label>
          <select id="laporan">
            <option value="Performance Summary">Performance Summary</option>
            <option value="Laporan Keuangan">Laporan Keuangan</option>
          </select>
        </div>

        <div class="row">
          <div class="col">
            <label>Kode Perusahaan (pisahkan dengan koma)</label>
            <input id="kode" type="text" placeholder="Contoh: AALI, MYOR, INDF" value="MYOR, INDF, AALI">
          </div>
          <div class="col">
            <label>Tahun (pisahkan dengan koma)</label>
            <input id="tahun" type="text" placeholder="Contoh: 2020, 2021, 2022" value="2020, 2021, 2022, 2023, 2024">
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Format</label>
            <select id="format">
              <option value="pdf">pdf</option>
              <option value="xlsx">xlsx</option>
            </select>
          </div>
          <div class="col">
            <label>Link</label>
            <select id="linkType">
              <option value="Full">Full</option>
              <option value="Clean Link">Clean Link</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button id="generate">Generate</button>
          <button id="copyAll" class="ghost">Copy All</button>
          <button id="downloadAll" class="ghost">Download All (.txt)</button>
        </div>

        <div class="note">Instruksi: gunakan ekstensi pengunduh batch jika ingin mendownload semua URL sekaligus (contoh: Chrono Download Manager).</div>

        <div id="results" style="margin-top:12px"></div>
      </div>
    </div>
  </div>

  <script>
    const templates = {
      "Laporan Keuangan": function(kode, tahun, ext) {
        return `https://www.idx.co.id/Portals/0/StaticData/ListedCompanies/Corporate_Actions/New_Info_JSX/Jenis_Informasi/01_Laporan_Keuangan/02_Soft_Copy_Laporan_Keuangan/Laporan%20Keuangan%20Tahun%20${tahun}/Audit/${kode}/FinancialStatement-${tahun}-Tahunan-${kode}.${ext}`;
      },
      "Performance Summary": function(kode) {
        return `https://www.idx.co.id/Portals/0/StaticData/ListedCompanies/PerformanceSummary/${kode}.pdf`;
      }
    };

    function normalizeList(text, uppercase=false) {
      if(!text) return [];
      return text.split(',').map(s=>s.trim()).filter(Boolean).map(s=> uppercase ? s.toUpperCase() : s);
    }

    function generate() {
      const laporan = document.getElementById('laporan').value;
      const kodeList = normalizeList(document.getElementById('kode').value, true);
      const tahunList = normalizeList(document.getElementById('tahun').value, false);
      const ext = document.getElementById('format').value;
      const linkType = document.getElementById('linkType').value;

      const results = [];

      if(laporan === 'Laporan Keuangan'){
        if(kodeList.length === 0 || tahunList.length === 0){
          alert('Masukkan setidaknya 1 kode dan 1 tahun untuk Laporan Keuangan.');
          return;
        }
        for(const kode of kodeList){
          for(const tahun of tahunList){
            const url = templates['Laporan Keuangan'](kode, tahun, ext);
            if(linkType === 'Clean Link') results.push(url);
            else results.push(`${kode}-${tahun}:${url}`);
          }
        }
      } else if(laporan === 'Performance Summary'){
        if(kodeList.length === 0){ alert('Masukkan setidaknya 1 kode.'); return; }
        for(const kode of kodeList){
          const url = templates['Performance Summary'](kode);
          if(linkType === 'Clean Link') results.push(url);
          else results.push(`${kode}:${url}`);
        }
      }

      renderResults(results);
    }

    function renderResults(results){
      const container = document.getElementById('results');
      container.innerHTML = '';
      if(results.length === 0){ container.innerHTML = '<small class="note">Tidak ada hasil.</small>'; return; }

      const frag = document.createDocumentFragment();
      results.forEach((line, idx)=>{
        const wrap = document.createElement('div'); wrap.className='result-item';
        const left = document.createElement('div'); left.className='links';
        const a = document.createElement('a');
        const parts = line.split(':');
        let display = line;
        let url = line;
        if(parts.length>=2 && parts[0].match(/^[A-Z0-9-]+$/)){
          url = parts.slice(1).join(':');
          display = line;
        }
        a.href = url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = display;
        left.appendChild(a);

        const right = document.createElement('div');
        const copyBtn = document.createElement('button'); copyBtn.textContent='Copy'; copyBtn.className='ghost';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(line).then(()=>{ copyBtn.textContent='Copied'; setTimeout(()=>copyBtn.textContent='Copy',900); }) };
        const openBtn = document.createElement('button'); openBtn.textContent='Open';
        openBtn.onclick = ()=> window.open(url,'_blank');

        right.appendChild(copyBtn);
        right.appendChild(openBtn);

        wrap.appendChild(left);
        wrap.appendChild(right);
        frag.appendChild(wrap);
      });

      container.appendChild(frag);
      container.dataset.last = JSON.stringify(results);
    }

    document.getElementById('generate').addEventListener('click', generate);
    document.getElementById('copyAll').addEventListener('click', ()=>{
      const container = document.getElementById('results');
      const data = container.dataset.last ? JSON.parse(container.dataset.last) : [];
      if(data.length===0){ alert('Belum ada hasil untuk disalin.'); return; }
      const txt = data.join('\n');
      navigator.clipboard.writeText(txt).then(()=> alert('Semua link disalin ke clipboard'));
    });

    document.getElementById('downloadAll').addEventListener('click', ()=>{
      const container = document.getElementById('results');
      const data = container.dataset.last ? JSON.parse(container.dataset.last) : [];
      if(data.length===0){ alert('Belum ada hasil untuk diunduh.'); return; }
      const blob = new Blob([data.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'idx_links.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    generate();
  </script>
</body>
</html>
